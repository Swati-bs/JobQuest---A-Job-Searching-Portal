<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify OTP</title>
    <script>
        let timer = 20; // Timer in seconds (1.5 minutes)
        
        document.addEventListener('DOMContentLoaded', () => {
            const countdownElement = document.getElementById('countdown');
            const resendButton = document.getElementById('resend-btn');
    
            resendButton.disabled = true; // Disable the resend button initially
    
            // Function to update the timer on the UI
            const updateTimer = () => {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                countdownElement.textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
            };
    
            // Start the countdown
            const countdown = setInterval(() => {
                if (timer > 0) {
                    timer--; // Decrease the timer
                    updateTimer(); // Update the timer display
                } else {
                    clearInterval(countdown); // Stop the countdown
                    resendButton.disabled = false; // Enable the resend button
                }
            }, 1000); // Execute every 1 second
    
            // Initially display the timer
            updateTimer();
        });
    
        function resendOTP() {
            console.log("Resend OTP button clicked!");  // Add this for debugging
            fetch("{% url 'resend_otp' %}", {
                method: 'GET',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            console.log(response)
            .then(data => {
                if (data.success) {
                    alert(data.message); // Show success message
                    timer = 20; // Reset the timer
                    resendButton.disabled = true; // Disable the resend button
                    const countdown = setInterval(() => {
                        if (timer > 0) {
                            timer--;
                            updateTimer();
                        } else {
                            clearInterval(countdown);
                            resendButton.disabled = false;
                        }
                    }, 1000);
                } else {
                    alert(data.message); // Show error message
                }
            });
        }
    </script>
    
</head>
<body>
    <h2>Verify OTP</h2>
    <form method="post">
        {% csrf_token %}
        <label for="otp">Enter OTP:</label>
        <input type="text" id="otp" name="otp" placeholder="Enter OTP" required>
        <button type="submit">Verify</button>
    </form>

    <p>Time remaining: <span id="countdown">00:30</span></p>
    <button id="resend-btn" onclick="resendOTP()">Resend OTP</button>
</body>
</html>
